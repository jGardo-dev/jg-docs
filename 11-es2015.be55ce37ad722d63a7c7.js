(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"7DJ4":function(t,e,r){"use strict";r.d(e,"a",(function(){return p}));var n=r("Fz9N"),i=r("z6cu"),s=r("LRne"),a=r("lJxs"),o=r("bOdf"),c=r("vkgz"),l=r("HDdC");class u{constructor(t,e,r,n,i,s){this.name=t,this.path=e,this.dataSource=r,this.type=n,this.entries=i,this.loadMoreEntries=s,this.entries=this.entries||[],s||(this.loadMoreEntries=null)}}class h{constructor(t,e){this.fileSystemEntry=t,this.content=e}}class b{constructor(t,e){this.dataSource=t,this.bitbucketClient=e}getDataSource(){return this.dataSource}resolvePath(t){return this.bitbucketClient.resolvePath(t).pipe(Object(a.a)(e=>this.createFileSystemEntry(t,e)))}createFileSystemEntry(t,e){const{data:r}=e;""!==t&&"/"===t.charAt(0)||(t="/"+t);const n=t.substr(t.lastIndexOf("/")+1);if(r.values){const e=this.createEntries(r.values),i=this.createNextPage(r,t);return new u(n,t,this.dataSource,"DIRECTORY",e,i)}return new u(n,t,this.dataSource,"FILE",[])}createEntries(t){return t.map(t=>{const e=t.path.substr(t.path.lastIndexOf("/")+1);let r=null;return"commit_directory"===t.type?r="DIRECTORY":"commit_file"===t.type&&(r="FILE"),new u(e,"/"+t.path,this.dataSource,r)})}createNextPage(t,e){const r=t.next&&new URL(t.next);return t.next&&r.searchParams.has("page")?()=>new l.a(t=>{const n=r.searchParams.get("page");this.bitbucketClient.resolvePath(e,n).pipe(Object(a.a)(t=>this.createFileSystemEntry(e,t))).subscribe(e=>{t.next(e),t.complete()},e=>t.error(e))}):null}resolveFile(t){return this.bitbucketClient.resolvePath(t).pipe(Object(a.a)(e=>{const r=this.createFileSystemEntry(t,e);if("FILE"!==r.type)throw new Error("This is not a file!!!");return new h(r,e.data)}))}refresh(){return this.bitbucketClient.refresh().pipe(Object(a.a)(()=>{}))}}var f=r("fXoL"),d=r("4HZ0");let p=(()=>{class t{constructor(t){this.bitbucketService=t,this.facadesById={}}get(t){return null===t?Object(i.a)("Id cannot be null"):this.bitbucketService.list().pipe(Object(a.a)(t=>t.map(t=>new n.a(`bb-${t.workspace.name}-${t.repository.name}`,`${t.workspace.name}/${t.repository.name}`,"BITBUCKET",t))),Object(o.a)(e=>{const r=e.find(e=>e.id===t);return r&&"BITBUCKET"===r.type?this.facadesById[t]?Object(s.a)(this.facadesById[t]):this.bitbucketService.createBitbucketClient(r.config).pipe(Object(c.a)(e=>{setTimeout(()=>{this.facadesById[t]=null},e.expiresIn)}),Object(a.a)(t=>new b(r,t)),Object(c.a)(e=>{this.facadesById[t]=e})):Object(i.a)("unknown datasource: "+r)}))}refresh(t){return t.refresh().pipe(Object(o.a)(()=>(this.facadesById[t.getDataSource().id]=t,this.bitbucketService.refresh(t.getDataSource().config))))}}return t.\u0275fac=function(e){return new(e||t)(f.Vb(d.a))},t.\u0275prov=f.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},"I/6E":function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var n=r("nYR2"),i=r("fXoL");let s=(()=>{class t{constructor(){}finishRefresher(t){return Object(n.a)(()=>{t.target.complete()})}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},MWW1:function(t,e,r){"use strict";r.r(e),r.d(e,"FileSystemPageModule",(function(){return O}));var n=r("TEn/"),i=r("ofXK"),s=r("3Pt+"),a=r("tyNb"),o=r("z6cu"),c=r("Cfvw"),l=r("vkgz"),u=r("JIr8"),h=r("bOdf"),b=r("fXoL"),f=r("YZAu"),d=r("I/6E"),p=r("7DJ4");function m(t,e){if(1&t){const t=b.Sb();b.Rb(0,"ion-item",8),b.Zb("click",(function(){return b.hc(t),b.bc().goBack()})),b.Pb(1,"ion-icon",9),b.Rb(2,"ion-label"),b.pc(3,".."),b.Qb(),b.Qb()}if(2&t){const t=b.bc();b.ec("routerLink",t.backPath())}}function y(t,e){1&t&&b.Pb(0,"ion-icon",9)}function S(t,e){1&t&&b.Pb(0,"ion-icon",12)}function v(t,e){if(1&t){const t=b.Sb();b.Rb(0,"ion-item",8),b.Zb("click",(function(){b.hc(t);const r=e.$implicit;return b.bc().goToItem(r)})),b.nc(1,y,1,0,"ion-icon",10),b.nc(2,S,1,0,"ion-icon",11),b.Rb(3,"ion-label"),b.pc(4),b.Qb(),b.Qb()}if(2&t){const t=e.$implicit,r=b.bc();b.ec("routerLink",r.itemPath(t)),b.Eb(1),b.ec("ngIf","DIRECTORY"===t.type),b.Eb(1),b.ec("ngIf","FILE"===t.type),b.Eb(2),b.qc(t.name)}}let g=(()=>{class t{constructor(t,e,r,n,i){this.route=t,this.router=e,this.toastService=r,this.refresherService=n,this.fileSystemFacadeCacheService=i,this.nextPage=null}ngOnInit(){this.routeDataSubscription=this.route.data.subscribe(t=>{this.fileSystemEntry=t.fileSystemEntry,this.fileSystemFacade=t.fileSystemFacade,this.nextPage=this.fileSystemEntry.loadMoreEntries})}ngAfterViewInit(){this.routeDataSubscription=this.route.data.subscribe(()=>{this.infiniteScroll.disabled=!this.fileSystemEntry.loadMoreEntries})}ngOnDestroy(){this.routeDataSubscription.unsubscribe()}goToItem(t){this.router.navigate(this.itemPath(t))}itemPath(t){const e=t.path.substr(1).split("/"),r=this.getFileSystemPrefix();return e[e.length-1]=e[e.length-1]+("FILE"===t.type?"-details":""),[r].concat(e)}goBack(){this.router.navigate(this.backPath())}backPath(){const t=this.fileSystemEntry.path.substr(0,this.fileSystemEntry.path.lastIndexOf("/")).substr(1).split("/");return[this.getFileSystemPrefix()].concat(t)}getFileSystemPrefix(){return"/tabs/home/file-system/"+this.fileSystemEntry.dataSource.id}loadData(t){this.nextPage().pipe(Object(l.a)(e=>{this.nextPage=e.loadMoreEntries,this.fileSystemEntry.entries.push(...e.entries),t.target.complete(),this.nextPage||(t.target.disabled=!0)}),this.toastService.catchErrorAndShowToast(),Object(u.a)(e=>(t.target.complete(),Object(o.a)(e)))).subscribe()}doRefresh(t){this.fileSystemFacadeCacheService.refresh(this.fileSystemFacade).pipe(Object(h.a)(()=>{const t=this.fileSystemEntry.path.split("/");return Object(c.a)(this.router.navigate([this.getFileSystemPrefix()].concat(t),{skipLocationChange:!0,state:{refreshTime:new Date}}))}),this.refresherService.finishRefresher(t),this.toastService.catchErrorAndShowToast()).subscribe()}}return t.\u0275fac=function(e){return new(e||t)(b.Ob(a.a),b.Ob(a.g),b.Ob(f.a),b.Ob(d.a),b.Ob(p.a))},t.\u0275cmp=b.Ib({type:t,selectors:[["app-file-system"]],viewQuery:function(t,e){var r;1&t&&b.sc(n.m,!0),2&t&&b.gc(r=b.ac())&&(e.infiniteScroll=r.first)},decls:16,vars:6,consts:[[3,"translucent"],["icon","folder"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],["detail","",3,"routerLink","click",4,"ngIf"],["detail","",3,"routerLink","click",4,"ngFor","ngForOf"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","bubbles","loadingText","Wczytuj\u0119 wi\u0119cej danych..."],["detail","",3,"routerLink","click"],["name","folder","slot","start"],["name","folder","slot","start",4,"ngIf"],["name","document","slot","start",4,"ngIf"],["name","document","slot","start"]],template:function(t,e){1&t&&(b.Rb(0,"ion-header",0),b.Rb(1,"ion-toolbar"),b.Rb(2,"ion-title"),b.Pb(3,"ion-icon",1),b.Rb(4,"ion-label"),b.pc(5),b.Qb(),b.Qb(),b.Qb(),b.Qb(),b.Rb(6,"ion-content",2),b.Rb(7,"ion-refresher",3),b.Zb("ionRefresh",(function(t){return e.doRefresh(t)})),b.Pb(8,"ion-refresher-content"),b.Qb(),b.Rb(9,"ion-list"),b.Rb(10,"ion-list-header"),b.pc(11," Lista plik\xf3w: "),b.Qb(),b.nc(12,m,4,1,"ion-item",4),b.nc(13,v,5,4,"ion-item",5),b.Qb(),b.Rb(14,"ion-infinite-scroll",6),b.Zb("ionInfinite",(function(t){return e.loadData(t)})),b.Pb(15,"ion-infinite-scroll-content",7),b.Qb(),b.Qb()),2&t&&(b.ec("translucent",!0),b.Eb(5),b.rc(" /",e.fileSystemEntry.dataSource.id,"",null==e.fileSystemEntry?null:e.fileSystemEntry.path," "),b.Eb(1),b.ec("fullscreen",!0),b.Eb(6),b.ec("ngIf","/"!==e.fileSystemEntry.path),b.Eb(1),b.ec("ngForOf",null==e.fileSystemEntry?null:e.fileSystemEntry.entries))},directives:[n.k,n.G,n.F,n.l,n.s,n.h,n.v,n.w,n.t,n.u,i.i,i.h,n.m,n.n,n.o,n.L,a.h],styles:[""]}),t})();var E=r("Yn41");const I=[{path:":fileSystemId",children:[{matcher:(t,e,r)=>t.length>0&&t[t.length-1].path.endsWith("-details")?{consumed:[]}:null,loadChildren:()=>r.e(12).then(r.bind(null,"3pp/")).then(t=>t.FilePageModule)},{path:"**",component:g,runGuardsAndResolvers:"always",resolve:{fileSystemFacade:E.a,fileSystemEntry:(()=>{class t{constructor(t,e){this.toastService=t,this.fileSystemFacadeResolverService=e}resolve(t,e){const r=t.url.map(t=>t.path).join("/"),n=r.endsWith("-details")?r.substr(0,r.length-"-details".length):r,i={};return this.fileSystemFacadeResolverService.resolve(t,e).pipe(Object(h.a)(t=>this.resolveForUrlAndParamMap(t,n,i)),this.toastService.catchErrorAndShowToast())}resolveForUrlAndParamMap(t,e,r){return t.resolvePath(e)}}return t.\u0275fac=function(e){return new(e||t)(b.Vb(f.a),b.Vb(E.a))},t.\u0275prov=b.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]}];let w=(()=>{class t{}return t.\u0275mod=b.Mb({type:t}),t.\u0275inj=b.Lb({factory:function(e){return new(e||t)},imports:[[a.i.forChild(I)],a.i]}),t})();var k=r("5M1D");let O=(()=>{class t{}return t.\u0275mod=b.Mb({type:t}),t.\u0275inj=b.Lb({factory:function(e){return new(e||t)},imports:[[n.H,i.b,s.a,w,k.a]]}),t})()},YZAu:function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));var n=r("JIr8"),i=r("z6cu"),s=r("fXoL"),a=r("TEn/");let o=(()=>{class t{constructor(t){this.toastController=t}catchErrorAndShowToast(){return Object(n.a)(t=>(this.showErrorToast(),Object(i.a)(t)))}showErrorToast(){this.toastController.create({message:"Co\u015b posz\u0142o nie tak...",duration:700}).then(t=>{t.present().then()})}}return t.\u0275fac=function(e){return new(e||t)(s.Vb(a.M))},t.\u0275prov=s.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},Yn41:function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));var n=r("fXoL"),i=r("YZAu"),s=r("7DJ4");let a=(()=>{class t{constructor(t,e){this.toastService=t,this.fileSystemFacadeCacheService=e}resolve(t,e){const r=e.url.endsWith("-details")?e.url.substr(0,e.url.length-"-details".length):e.url,n={};for(const i of t.paramMap.keys)n[i]=t.paramMap.get(i);return this.resolveForUrlAndParamMap(r,n).pipe(this.toastService.catchErrorAndShowToast())}resolveForUrlAndParamMap(t,e){return this.fileSystemFacadeCacheService.get(e.fileSystemId)}}return t.\u0275fac=function(e){return new(e||t)(n.Vb(i.a),n.Vb(s.a))},t.\u0275prov=n.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},z6cu:function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r("HDdC");function i(t,e){return new n.a(e?r=>e.schedule(s,0,{error:t,subscriber:r}):e=>e.error(t))}function s({error:t,subscriber:e}){e.error(t)}}}]);